name: ✨ Auto Updater
run-name: ✨ Auto Updater [${{ inputs.update_name }}] on [${{ inputs.repositories }}]

on:
  workflow_dispatch:
    inputs:
      repositories:
        description: "Repositories [eg. repo1,repo2]"
        required: true
        type: string
      update_name:
        description: "Update name"
        required: true
        type: choice
        default: add-todo-md
        options:
          - add-todo-md

jobs:

  auto-updater:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: write
      pull-requests: write

    steps:

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup git user
        id: setup_git_user
        env:
          GH_TOKEN: ${{ secrets.GH_AUTO_UPDATER_SECRET }}        
        run: |          
          
          git config --global user.name 'Vincent Spiewak'
          git config --global credential.username "vspiewak"
          
          gh auth setup-git

      - name: Run auto-updater
        env:
          GH_TOKEN: ${{ secrets.GH_AUTO_UPDATER_SECRET }}
        run: |

          ./auto-updater/run.sh \
            --repositories "${{ inputs.repositories }}" \
            --update-name "${{ inputs.update_name }}"